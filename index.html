<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#000000">
    <title>Sunday iOS</title>
    
    <link rel="apple-touch-icon" sizes="180x180" href="logosunday.jpg">
    <link rel="icon" type="image/png" href="logosunday.jpg">
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <style>
        :root {
            /* --- iOS Tech Blue Palette --- */
            --bg-deep: #000000;
            --bg-gradient: linear-gradient(160deg, #0a0a12 0%, #051937 100%);
            
            /* Apple "Glass" Material */
            --glass-bg: rgba(30, 40, 60, 0.65);
            --glass-border: rgba(255, 255, 255, 0.12);
            --glass-blur: blur(25px);
            
            /* Colors */
            --accent-blue: #0A84FF; /* iOS System Blue */
            --accent-cyan: #64D2FF; /* iOS Cyan */
            --text-primary: #FFFFFF;
            --text-secondary: rgba(235, 235, 245, 0.6); /* iOS Secondary Text */
            
            /* Spacing & Radius */
            --card-radius: 22px;
            --nav-height: 85px;
            --safe-area-top: env(safe-area-inset-top);
            --safe-area-bottom: env(safe-area-inset-bottom);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Helvetica Neue", sans-serif;
            background: var(--bg-deep);
            color: var(--text-primary);
            min-height: 100vh;
            /* ÁßëÊäÄÊÑüÊ∑±ÈÇÉËÉåÊôØ */
            background-image: radial-gradient(circle at 10% 20%, rgba(10, 132, 255, 0.15) 0%, transparent 40%),
                              radial-gradient(circle at 90% 80%, rgba(100, 210, 255, 0.1) 0%, transparent 40%);
            background-attachment: fixed;
            padding-bottom: calc(var(--nav-height) + 20px);
            font-size: 17px; /* üçé ËàíÈÄÇÁöÑ‰∏≠Á≠âÂ≠óÂè∑ */
            line-height: 1.4;
        }

        /* --- Header (iOS Large Title) --- */
        .ios-header {
            padding: calc(var(--safe-area-top) + 20px) 20px 10px;
            display: flex; justify-content: space-between; align-items: flex-end;
        }
        
        .header-title h1 { font-size: 34px; font-weight: 700; letter-spacing: -0.5px; margin-bottom: 5px; }
        .header-title span { font-size: 13px; color: var(--accent-cyan); text-transform: uppercase; letter-spacing: 1px; font-weight: 600; }
        
        .header-profile img { width: 44px; height: 44px; border-radius: 50%; border: 2px solid rgba(255,255,255,0.2); }

        /* --- Layout Container --- */
        .content-scroll { padding: 10px 20px; }

        /* --- Glass Cards (The "Tech" Feel) --- */
        .glass-card {
            background: var(--glass-bg);
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
            border: 1px solid var(--glass-border);
            border-radius: var(--card-radius);
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            transition: transform 0.2s;
        }
        .glass-card:active { transform: scale(0.98); }

        /* --- Typography Tweaks --- */
        h2 { font-size: 20px; font-weight: 600; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
        .label { font-size: 13px; color: var(--text-secondary); margin-bottom: 4px; display: block; }
        .value { font-size: 24px; font-weight: 600; font-family: "SF Pro Display", sans-serif; }

        /* --- Weather Widget (Big & Clean) --- */
        .weather-widget { display: flex; align-items: center; justify-content: space-between; }
        .weather-main { display: flex; flex-direction: column; }
        .temp-big { font-size: 52px; font-weight: 200; letter-spacing: -1px; line-height: 1; }
        .weather-icon-big { font-size: 60px; filter: drop-shadow(0 0 15px rgba(255,255,255,0.2)); }
        
        .weather-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-top: 15px; }
        .mini-stat { background: rgba(255,255,255,0.05); padding: 10px; border-radius: 12px; text-align: center; }
        .mini-stat span { display: block; font-size: 14px; font-weight: 600; color: var(--accent-cyan); }
        .mini-stat small { font-size: 11px; color: var(--text-secondary); }

        /* --- Map Card --- */
        .map-wrapper { height: 220px; width: 100%; border-radius: 16px; overflow: hidden; position: relative; margin-top: 10px; }
        #journeyMapSmall { width: 100%; height: 100%; }
        
        /* --- Buttons (iOS Style) --- */
        .btn-ios {
            background: var(--accent-blue);
            color: white;
            border: none;
            padding: 14px;
            border-radius: 14px;
            width: 100%;
            font-size: 16px;
            font-weight: 600;
            display: flex; align-items: center; justify-content: center; gap: 8px;
            margin-top: 10px;
            box-shadow: 0 4px 15px rgba(10, 132, 255, 0.3); /* Tech Glow */
        }
        .btn-ios.secondary { background: rgba(255,255,255,0.1); color: var(--accent-cyan); box-shadow: none; }
        
        /* --- Input Fields --- */
        .ios-input {
            width: 100%;
            background: rgba(0,0,0,0.3);
            border: none;
            padding: 14px 16px;
            border-radius: 12px;
            color: white;
            font-size: 16px;
            margin-bottom: 10px;
        }
        .ios-input::placeholder { color: rgba(255,255,255,0.3); }
        .ios-input:focus { outline: 1px solid var(--accent-blue); background: rgba(0,0,0,0.5); }

        /* --- Tab Bar (Frosted Glass) --- */
        .tab-bar {
            position: fixed; bottom: 20px; left: 20px; right: 20px;
            height: 65px;
            background: rgba(20, 20, 30, 0.85); /* Slightly darker for contrast */
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
            border-radius: 35px; /* Pill Shape */
            border: 1px solid rgba(255,255,255,0.1);
            display: flex; justify-content: space-around; align-items: center;
            z-index: 1000;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }
        
        .tab-btn {
            background: none; border: none;
            color: rgba(255,255,255,0.4);
            font-size: 24px;
            width: 50px; height: 50px;
            display: flex; justify-content: center; align-items: center;
            border-radius: 50%;
            transition: 0.3s;
        }
        .tab-btn.active {
            color: var(--accent-blue);
            background: rgba(10, 132, 255, 0.15);
            box-shadow: 0 0 15px rgba(10, 132, 255, 0.2);
        }

        /* Page Logic */
        .page { display: none; opacity: 0; transition: opacity 0.3s; }
        .page.active { display: block; opacity: 1; }

        /* Utilities */
        .hidden { display: none !important; }
        .toast { position: fixed; top: 60px; left: 50%; transform: translateX(-50%); background: rgba(50,50,50,0.9); padding: 10px 20px; border-radius: 30px; font-size: 14px; display: none; backdrop-filter: blur(10px); z-index: 9999; box-shadow: 0 5px 20px rgba(0,0,0,0.3); }
        .toast.show { display: block; animation: slideDown 0.3s ease-out; }
        @keyframes slideDown { from { transform: translate(-50%, -20px); opacity:0; } to { transform: translate(-50%, 0); opacity:1; } }

    </style>
</head>
<body>

    <header class="ios-header">
        <div class="header-title">
            <span>Sunday AI</span>
            <h1>Dashboard</h1>
        </div>
        <div class="header-profile" onclick="document.getElementById('photoInput').click()">
            <img src="logosunday.jpg" alt="Profile">
        </div>
    </header>

    <div class="content-scroll">
        
        <div id="page-home" class="page active">
            <div class="glass-card">
                <h2><span style="font-size:16px;">üìç</span> <span id="weatherLocation">Locating...</span></h2>
                <div class="weather-widget">
                    <div class="weather-main">
                        <div class="temp-big"><span id="weatherTemp">--</span>¬∞</div>
                        <div class="label" id="weatherCondition" style="margin-top:5px; font-size:15px;">Clear Sky</div>
                    </div>
                    <div class="weather-icon-big" id="weatherIcon">üå§Ô∏è</div>
                </div>
                <div class="weather-grid">
                    <div class="mini-stat"><span><span id="weatherWind">--</span></span><small>Wind</small></div>
                    <div class="mini-stat"><span><span id="weatherHumidity">--</span>%</span><small>Humid</small></div>
                    <div class="mini-stat"><span><span id="weatherRain">--</span>%</span><small>Rain</small></div>
                </div>
            </div>

            <div class="glass-card">
                <h2>üîî Briefing</h2>
                <div id="briefingContent" style="font-size:14px; line-height:1.6; color:var(--text-secondary);">
                    Loading daily updates...
                </div>
            </div>
        </div>

        <div id="page-journey" class="page">
            <div class="glass-card">
                <h2>üèÉ‚Äç‚ôÇÔ∏è Tracker <span class="label" style="margin-left:auto;" id="journeyModeText">Ready</span></h2>
                
                <div class="weather-grid" style="margin-bottom:15px;">
                    <div class="mini-stat"><span><span id="jDistance">0.0</span></span><small>km</small></div>
                    <div class="mini-stat"><span><span id="jTime">00:00</span></span><small>Time</small></div>
                    <div class="mini-stat"><span><span id="jCalories">0</span></span><small>Kcal</small></div>
                </div>

                <div class="map-wrapper">
                    <div id="journeyMapSmall"></div>
                </div>

                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:15px;">
                    <button class="btn-ios" onclick="startJourney()">Start</button>
                    <button class="btn-ios secondary" onclick="endJourney()" style="color:#ff453a; background:rgba(255, 69, 58, 0.15);">Stop</button>
                </div>
            </div>
        </div>

        <div id="page-parking" class="page">
            <div class="glass-card">
                <h2>üÖøÔ∏è My Car</h2>
                <div id="parkingDisplay" style="text-align:center; padding:30px 0; color:var(--text-secondary);">
                    <div style="font-size:40px; margin-bottom:10px; opacity:0.5;">üöó</div>
                    No location saved
                </div>
                <button class="btn-ios" onclick="saveParking('gps')">üìç Save GPS</button>
                <button class="btn-ios secondary" onclick="document.getElementById('photoInput').click()">üì∏ Take Photo</button>
            </div>
        </div>

        <div id="page-tools" class="page">
            <div class="glass-card">
                <h2>üí¨ Chat AI</h2>
                <div id="chatMessages" style="height:200px; overflow-y:auto; background:rgba(0,0,0,0.2); border-radius:12px; padding:10px; margin-bottom:10px;">
                    <div style="color:var(--text-secondary); font-size:13px; text-align:center;">Ask me about weather or health...</div>
                </div>
                <div style="display:flex; gap:10px;">
                    <input type="text" class="ios-input" id="chatInput" placeholder="Type here..." style="margin-bottom:0;">
                    <button class="btn-ios" style="width:auto; margin-top:0; padding:0 20px;" onclick="sendChat()">‚û§</button>
                </div>
            </div>

            <div class="glass-card">
                <h2>‚è∞ Reminder</h2>
                <input type="text" class="ios-input" id="reminderTask" placeholder="Remind me to...">
                <div style="display:flex; gap:10px;">
                    <select class="ios-input" id="reminderTime" style="margin-bottom:0;">
                        <option value="10">10 Mins</option>
                        <option value="60">1 Hour</option>
                    </select>
                    <button class="btn-ios" style="width:auto; margin-top:0;" onclick="addReminder()">Set</button>
                </div>
            </div>
        </div>

    </div>

    <nav class="tab-bar">
        <button class="tab-btn active" onclick="switchPage('home', this)">üè†</button>
        <button class="tab-btn" onclick="switchPage('journey', this)">üó∫Ô∏è</button>
        <button class="tab-btn" onclick="switchPage('parking', this)">üÖøÔ∏è</button>
        <button class="tab-btn" onclick="switchPage('tools', this)">üß©</button>
    </nav>

    <input type="file" id="photoInput" accept="image/*" style="display:none" onchange="handlePhoto(event)">
    <div class="toast" id="toast">‚úÖ Success</div>

    <script>
        // ================= JS LOGIC (‰øùÁïôÊ†∏ÂøÉÂäüËÉΩ) =================
        const APP = { journey: null, watchId: null, mapSmall: null, pathCoords: [], parking: null };
        const LOCATIONS = { 'Johor Jaya': { lat: 1.5360, lon: 103.7930 }, 'Tokyo': { lat: 35.6895, lon: 139.6917 } };

        document.addEventListener('DOMContentLoaded', () => {
            loadStorage();
            updateWeather('Johor Jaya', 1.536, 103.793);
            initMap();
            generateBriefing();
        });

        function switchPage(pageId, btn) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('page-' + pageId).classList.add('active');
            
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');

            // Âä®ÊÄÅ‰øÆÊîπÊ†áÈ¢ò
            const titles = { 'home': 'Dashboard', 'journey': 'Tracker', 'parking': 'Parking', 'tools': 'Tools' };
            document.querySelector('.header-title h1').textContent = titles[pageId];
            
            // Map resizing fix
            if(pageId === 'journey' && APP.mapSmall) setTimeout(() => APP.mapSmall.invalidateSize(), 200);
        }

        // --- Weather ---
        async function updateWeather(name, lat, lon) {
            try {
                const d = await (await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,weather_code,wind_speed_10m,relative_humidity_2m`)).json();
                document.getElementById('weatherLocation').textContent = name;
                document.getElementById('weatherTemp').textContent = Math.round(d.current.temperature_2m);
                document.getElementById('weatherWind').textContent = Math.round(d.current.wind_speed_10m);
                document.getElementById('weatherHumidity').textContent = d.current.relative_humidity_2m;
                
                // Weather Icon Logic
                const code = d.current.weather_code;
                let icon = '‚òÅÔ∏è', cond = 'Cloudy';
                if(code === 0) { icon = '‚òÄÔ∏è'; cond = 'Sunny'; }
                if(code > 0 && code <= 3) { icon = '‚õÖ'; cond = 'Partly Cloudy'; }
                if(code >= 61) { icon = 'üåßÔ∏è'; cond = 'Rainy'; }
                if(code >= 95) { icon = '‚ö°'; cond = 'Storm'; }
                document.getElementById('weatherIcon').textContent = icon;
                document.getElementById('weatherCondition').textContent = cond;
            } catch(e) { console.log(e); }
        }

        // --- Briefing ---
        async function generateBriefing() {
            let html = `<div>üìÖ ${new Date().toLocaleDateString('en-US', {weekday:'long', month:'long', day:'numeric'})}</div>`;
            try {
                const r = await (await fetch('https://api.exchangerate-api.com/v4/latest/SGD')).json();
                html += `<div style="margin-top:5px; color:var(--accent-cyan);">üí± SGD 1 ‚âà RM ${(r.rates.MYR).toFixed(2)}</div>`;
            } catch(e) {}
            document.getElementById('briefingContent').innerHTML = html;
        }

        // --- Map & Journey ---
        function initMap() {
            APP.mapSmall = L.map('journeyMapSmall', { zoomControl: false, attributionControl: false }).setView([1.536, 103.793], 13);
            L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', { subdomains: 'abcd', maxZoom: 19 }).addTo(APP.mapSmall);
        }

        function startJourney() {
            if (!navigator.geolocation) return showToast('GPS needed');
            showToast('Tracking Started üöÄ');
            document.getElementById('journeyModeText').textContent = "üî¥ Live";
            document.getElementById('journeyModeText').style.color = "#ff453a";
            
            APP.journey = { startTime: Date.now() };
            APP.pathCoords = [];
            APP.watchId = navigator.geolocation.watchPosition(pos => {
                const lat = pos.coords.latitude, lon = pos.coords.longitude;
                APP.pathCoords.push([lat, lon]);
                if(!APP.poly) APP.poly = L.polyline(APP.pathCoords, {color: '#0A84FF', weight: 5}).addTo(APP.mapSmall);
                else APP.poly.setLatLngs(APP.pathCoords);
                APP.mapSmall.setView([lat, lon], 16);
                
                document.getElementById('jDistance').textContent = (APP.pathCoords.length * 0.005).toFixed(2); // Fake calc for demo
            }, null, { enableHighAccuracy: true });

            APP.timerInterval = setInterval(() => {
                const s = Math.floor((Date.now() - APP.journey.startTime)/1000);
                document.getElementById('jTime').textContent = `${Math.floor(s/60).toString().padStart(2,'0')}:${(s%60).toString().padStart(2,'0')}`;
            }, 1000);
        }

        function endJourney() {
            if(APP.watchId) navigator.geolocation.clearWatch(APP.watchId);
            if(APP.timerInterval) clearInterval(APP.timerInterval);
            document.getElementById('journeyModeText').textContent = "Finished";
            document.getElementById('journeyModeText').style.color = "var(--text-secondary)";
            showToast('Journey Saved ‚úÖ');
        }

        // --- Parking ---
        function saveParking(type) {
            navigator.geolocation.getCurrentPosition(pos => {
                APP.parking = { lat: pos.coords.latitude, lon: pos.coords.longitude, time: Date.now() };
                localStorage.setItem('sun_park', JSON.stringify(APP.parking));
                renderParking();
                showToast('Location Saved');
            });
        }
        
        function handlePhoto(e) {
            const file = e.target.files[0];
            const reader = new FileReader();
            reader.onload = ev => {
                APP.parking = { photo: ev.target.result, time: Date.now() };
                localStorage.setItem('sun_park', JSON.stringify(APP.parking));
                renderParking();
                showToast('Photo Saved');
            };
            reader.readAsDataURL(file);
        }

        function renderParking() {
            const div = document.getElementById('parkingDisplay');
            if(!APP.parking) return;
            if(APP.parking.photo) div.innerHTML = `<img src="${APP.parking.photo}" style="width:100%; border-radius:12px; height:200px; object-fit:cover;">`;
            else if(APP.parking.lat) div.innerHTML = `<div style="padding:20px; font-weight:bold; color:var(--accent-blue);">üìç Location Locked<br><small style="color:white; font-weight:normal;">Tap to open maps</small></div>`;
            div.onclick = () => { if(APP.parking.lat) window.open(`http://maps.google.com/?q=${APP.parking.lat},${APP.parking.lon}`); };
        }

        // --- Utils ---
        function loadStorage() { try { APP.parking = JSON.parse(localStorage.getItem('sun_park')); renderParking(); } catch(e){} }
        
        function sendChat() {
            const val = document.getElementById('chatInput').value;
            if(!val) return;
            const box = document.getElementById('chatMessages');
            box.innerHTML += `<div style="text-align:right; margin:5px 0;"><span style="background:var(--accent-blue); padding:8px 12px; border-radius:16px; font-size:14px;">${val}</span></div>`;
            document.getElementById('chatInput').value = '';
            setTimeout(() => {
                box.innerHTML += `<div style="text-align:left; margin:5px 0;"><span style="background:rgba(255,255,255,0.1); padding:8px 12px; border-radius:16px; font-size:14px;">I'm just a demo AI. ü§ñ</span></div>`;
                box.scrollTop = box.scrollHeight;
            }, 800);
        }

        function addReminder() {
            showToast('Reminder Set ‚è∞');
            document.getElementById('reminderTask').value = '';
        }

        function showToast(msg) {
            const t = document.getElementById('toast');
            t.textContent = msg;
            t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 2000);
        }
    </script>
</body>
</html>
