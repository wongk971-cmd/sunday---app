<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Sunday">
    <meta name="theme-color" content="#000000">
    <title>Sunday V10 Ultimate</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <style>
        :root {
            /* V10 Apple OLED Black Theme */
            --bg-primary: #000000;
            --bg-secondary: #1c1c1e;
            --bg-tertiary: #2c2c2e;
            --accent-blue: #0A84FF;
            --accent-teal: #64D2FF;
            --accent-green: #30D158;
            --accent-red: #FF453A;
            --accent-orange: #FF9F0A;
            --text-primary: #FFFFFF;
            --text-secondary: rgba(255,255,255,0.6);
            --text-tertiary: rgba(255,255,255,0.4);
            --radius-md: 14px; --radius-lg: 20px; --radius-xl: 26px;
        }

        * { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', system-ui, sans-serif; background: var(--bg-primary); color: var(--text-primary); min-height: 100vh; padding-bottom: 80px; }
        .ambient-light { position: fixed; top: -120px; left: -120px; width: 350px; height: 350px; background: radial-gradient(circle, rgba(10,132,255,0.12) 0%, transparent 70%); z-index: -1; pointer-events: none; }
        .app { max-width: 440px; margin: 0 auto; padding: 0 16px; }

        /* Header */
        .header { display: flex; align-items: center; justify-content: space-between; padding: 16px 0 20px; }
        .logo-area { display: flex; align-items: center; gap: 12px; }
        .logo-icon { width: 44px; height: 44px; background: linear-gradient(135deg, #0A84FF, #5AC8FA); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px; box-shadow: 0 4px 15px rgba(10,132,255,0.3); }
        .logo-text h1 { font-size: 22px; font-weight: 700; line-height: 1.1; }
        .logo-text span { font-size: 11px; color: var(--text-tertiary); letter-spacing: 0.5px; text-transform: uppercase; font-weight: 500; }
        .header-time { text-align: right; }
        .header-time .time { font-size: 26px; font-weight: 700; color: var(--accent-blue); }
        .header-time .date { font-size: 11px; color: var(--text-tertiary); margin-top: 4px; }

        /* Nav */
        .nav { display: flex; gap: 6px; padding: 4px; background: var(--bg-secondary); border-radius: 16px; margin-bottom: 24px; overflow-x: auto; scrollbar-width: none; }
        .nav-btn { flex: 1; min-width: 60px; padding: 10px 0; border: none; background: transparent; color: var(--text-secondary); font-family: inherit; font-size: 10px; font-weight: 500; border-radius: 12px; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 4px; }
        .nav-btn.active { background: var(--accent-blue); color: white; }
        .page { display: none; animation: fadeIn 0.3s ease; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }

        /* V10 Widgets */
        .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 20px; }
        .stat-box { background: var(--bg-secondary); aspect-ratio: 1; border-radius: var(--radius-lg); display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 8px; }
        .stat-val { font-size: 20px; font-weight: 700; color: var(--accent-blue); margin-bottom: 2px; }
        .stat-lbl { font-size: 11px; color: var(--text-secondary); }

        /* Hydration */
        .hydration-card { background: linear-gradient(180deg, rgba(10,132,255,0.08) 0%, rgba(28,28,30,0) 100%), var(--bg-secondary); border: 1px solid rgba(10,132,255,0.15); border-radius: var(--radius-xl); padding: 20px; margin-bottom: 16px; }
        .hyd-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
        .hyd-title { font-size: 17px; font-weight: 600; color: white; }
        .hyd-count { font-size: 30px; font-weight: 700; color: white; }
        .hyd-progress-bg { height: 10px; background: rgba(255,255,255,0.1); border-radius: 100px; overflow: hidden; margin-bottom: 20px; }
        .hyd-progress-fill { height: 100%; background: linear-gradient(90deg, var(--accent-blue), var(--accent-teal)); width: 0%; transition: width 0.5s ease; }
        .hyd-btn-row { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; }
        .hyd-btn { background: var(--bg-tertiary); border: 1px solid rgba(255,255,255,0.05); padding: 14px 0; border-radius: var(--radius-md); color: white; font-weight: 600; font-size: 13px; cursor: pointer; }

        /* General UI */
        .card { background: var(--bg-secondary); border-radius: var(--radius-xl); padding: 20px; margin-bottom: 16px; }
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
        .card-title { font-size: 17px; font-weight: 600; color: white; }
        .input-field { width: 100%; padding: 16px; background: var(--bg-tertiary); border: 1px solid rgba(255,255,255,0.05); border-radius: var(--radius-md); color: white; font-size: 16px; margin-bottom: 12px; }
        .btn { width: 100%; padding: 16px; border-radius: var(--radius-md); border: none; font-weight: 600; font-size: 16px; cursor: pointer; }
        .btn-blue { background: var(--accent-blue); color: white; }
        .btn-red { background: var(--accent-red); color: white; }
        
        /* Specifics */
        .weather-main { display: flex; align-items: center; gap: 16px; }
        .weather-big-icon { font-size: 48px; }
        .weather-big-temp { font-size: 44px; font-weight: 700; }
        .badge-live { background: rgba(255,69,58,0.15); color: var(--accent-red); font-size: 11px; padding: 5px 10px; border-radius: 100px; font-weight: 700; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.4; } 100% { opacity: 1; } }

        /* Advanced Lists & Timeline (From V9) */
        .list-item { display: flex; align-items: center; padding: 16px; background: var(--bg-tertiary); border-radius: var(--radius-md); margin-bottom: 8px; justify-content: space-between; }
        .timeline-item { position: relative; padding-left: 20px; margin-bottom: 15px; border-left: 2px solid var(--bg-tertiary); }
        .timeline-dot { position: absolute; left: -6px; top: 0; width: 10px; height: 10px; border-radius: 50%; background: var(--accent-blue); }
        .timeline-dot.stop { background: var(--accent-orange); }
        
        /* Chat */
        .chat-box { height: 300px; overflow-y: auto; background: var(--bg-tertiary); border-radius: var(--radius-md); padding: 16px; margin-bottom: 12px; }
        .chat-msg { margin-bottom: 10px; max-width: 80%; padding: 10px 14px; border-radius: 16px; font-size: 14px; }
        .chat-msg.bot { background: var(--bg-secondary); color: var(--text-secondary); align-self: flex-start; }
        .chat-msg.user { background: var(--accent-blue); color: white; margin-left: auto; }
        
        /* Search Results */
        .search-results { background: var(--bg-tertiary); border-radius: var(--radius-md); max-height: 200px; overflow-y: auto; display: none; margin-top: -10px; margin-bottom: 10px; }
        .search-item { padding: 12px; border-bottom: 1px solid rgba(255,255,255,0.05); cursor: pointer; }

        .toast { position: fixed; top: 20px; left: 50%; transform: translateX(-50%) translateY(-150%); background: rgba(28,28,30,0.95); padding: 14px 24px; border-radius: 50px; display: flex; align-items: center; gap: 12px; transition: 0.4s; z-index: 9999; border: 1px solid rgba(255,255,255,0.1); width: max-content; }
        .toast.show { transform: translateX(-50%) translateY(0); }
    </style>
</head>
<body>

<div class="ambient-light"></div>

<div class="app">
    <header class="header">
        <div class="logo-area">
            <div class="logo-icon">‚òÄÔ∏è</div>
            <div class="logo-text"><h1>Sunday</h1><span>V10 ULTIMATE</span></div>
        </div>
        <div class="header-time">
            <div class="time" id="clockTime">00:00</div>
            <div class="date" id="clockDate">Loading...</div>
        </div>
    </header>

    <nav class="nav">
        <button class="nav-btn active" onclick="switchPage('home', this)"><span class="icon">üè†</span>Home</button>
        <button class="nav-btn" onclick="switchPage('life', this)"><span class="icon">üí´</span>Life</button>
        <button class="nav-btn" onclick="switchPage('weather', this)"><span class="icon">üå§Ô∏è</span>Weather</button>
        <button class="nav-btn" onclick="switchPage('journey', this)"><span class="icon">üó∫Ô∏è</span>Journey</button>
        <button class="nav-btn" onclick="switchPage('parking', this)"><span class="icon">üÖøÔ∏è</span>Parking</button>
        <button class="nav-btn" onclick="switchPage('alerts', this)"><span class="icon">üö®</span>Alerts</button>
        <button class="nav-btn" onclick="switchPage('chat', this)"><span class="icon">üí¨</span>Chat</button>
        <button class="nav-btn" onclick="switchPage('tools', this)"><span class="icon">üõ†Ô∏è</span>Tools</button>
    </nav>

    <div id="page-home" class="page active">
        <div class="stats-grid">
            <div class="stat-box"><div class="stat-val" id="dashTemp">--¬∞</div><div class="stat-lbl">Temp</div></div>
            <div class="stat-box"><div class="stat-val" id="dashAlerts">0</div><div class="stat-lbl">Quakes</div></div>
            <div class="stat-box"><div class="stat-val" id="dashJourneys">0</div><div class="stat-lbl">Journeys</div></div>
            <div class="stat-box"><div class="stat-val" id="dashReminders">0</div><div class="stat-lbl">Tasks</div></div>
        </div>

        <div class="hydration-card">
            <div class="hyd-header">
                <div class="hyd-title">üíß Hydration</div>
                <div class="hyd-count"><span id="waterVal">0</span><span>/ 8</span></div>
            </div>
            <div class="hyd-progress-bg"><div class="hyd-progress-fill" id="waterBar"></div></div>
            <div class="hyd-btn-row">
                <button class="hyd-btn" onclick="modWater(1)">+1 Cup</button>
                <button class="hyd-btn" onclick="modWater(2)">+2 Cups</button>
                <button class="hyd-btn" onclick="modWater(0)">Reset</button>
            </div>
        </div>

        <div class="card">
            <div class="card-header"><div class="card-title">üå§Ô∏è Weather</div><div class="badge-live">LIVE</div></div>
            <div class="weather-main" id="dashWeather">
                <div class="weather-big-icon">‚òÄÔ∏è</div>
                <div><div class="weather-big-temp">--¬∞C</div><div class="weather-sub">Loading...</div></div>
            </div>
        </div>
        
        <div class="card">
             <div class="card-title" style="margin-bottom:12px">üì∞ News Feed</div>
             <div id="news-feed" style="font-size:13px;">Loading RSS...</div>
        </div>
    </div>

    <div id="page-journey" class="page">
        <div class="card" id="journey-active" style="display:none; border:1px solid var(--accent-green)">
            <div class="card-header"><div class="card-title" style="color:var(--accent-green)">üöó Tracking</div><div class="badge-live" style="background:rgba(48,209,88,0.2);color:#30D158">REC</div></div>
            <div class="stats-grid" style="grid-template-columns:1fr 1fr 1fr; margin-bottom:16px">
                <div class="stat-box"><div class="stat-val" id="jDist">0.0</div><div class="stat-lbl">km</div></div>
                <div class="stat-box"><div class="stat-val" id="jSpeed">0</div><div class="stat-lbl">km/h</div></div>
                <div class="stat-box"><div class="stat-val" id="jTime">0</div><div class="stat-lbl">min</div></div>
            </div>
            <div style="height:200px;background:#222;border-radius:12px;margin-bottom:12px" id="map-small"></div>
            <div id="journey-timeline-live" style="max-height:100px;overflow-y:auto;font-size:12px;margin-bottom:12px"></div>
            <button class="btn btn-red" onclick="stopJourney()">End Journey üèÅ</button>
        </div>

        <div class="card" id="journey-start">
            <div class="card-title" style="margin-bottom:16px">üöÄ New Journey</div>
            <button class="btn btn-blue" onclick="startJourney()">Start Tracking</button>
        </div>

        <div class="card">
            <div class="card-title" style="margin-bottom:12px">üìú History</div>
            <div id="journey-list"></div>
        </div>
    </div>

    <div id="page-alerts" class="page">
        <div class="card">
            <div class="card-header"><div class="card-title">üö® Earthquakes (USGS)</div></div>
            <div id="quake-list" style="max-height:400px;overflow-y:auto">Loading...</div>
        </div>
    </div>

    <div id="page-chat" class="page">
        <div class="card" style="height:calc(100vh - 180px);display:flex;flex-direction:column">
            <div class="card-title" style="margin-bottom:10px">üí¨ Assistant</div>
            <div class="chat-box" id="chatBox">
                <div class="chat-msg bot">Hello! I can help with weather, medical tips, or tools. Try typing "fever" or "weather Tokyo".</div>
            </div>
            <div style="display:flex;gap:10px;margin-top:auto">
                <input type="text" id="chatInput" class="input-field" style="margin:0" placeholder="Type..." onkeypress="if(event.key==='Enter')sendChat()">
                <button class="btn btn-blue" style="width:auto;padding:0 20px" onclick="sendChat()">‚û§</button>
            </div>
        </div>
    </div>

    <div id="page-weather" class="page">
        <div class="card">
             <div class="card-title" style="margin-bottom:10px">üåç Global Search</div>
             <input type="text" class="input-field" id="citySearch" placeholder="Search city..." onkeyup="handleSearch(this.value)">
             <div class="search-results" id="searchResults"></div>
             
             <div style="text-align:center;margin-top:20px">
                 <div class="weather-big-icon" id="w-icon">‚òÄÔ∏è</div>
                 <div class="weather-big-temp" id="w-temp">--¬∞</div>
                 <div class="weather-sub" id="w-desc">Search a city</div>
             </div>
        </div>
    </div>

    <div id="page-parking" class="page">
        <div class="card">
            <div class="card-title">üöó My Car</div>
            <div id="park-display" style="text-align:center;padding:30px;color:var(--text-tertiary)">No location</div>
            <div class="hyd-btn-row">
                <button class="hyd-btn" onclick="savePark('gps')">GPS</button>
                <button class="hyd-btn" onclick="document.getElementById('cam').click()">Photo</button>
                <button class="hyd-btn" onclick="savePark('both')">Both</button>
            </div>
            <input type="file" id="cam" accept="image/*" style="display:none" onchange="handlePhoto(event)">
        </div>
    </div>

    <div id="page-tools" class="page">
        <div class="card"><div class="card-title">üí± Rates</div><div id="rate-list">Loading...</div></div>
        <div class="card"><div class="card-title">‚è∞ Reminders</div><input type="text" id="rem-txt" class="input-field"><button class="btn btn-blue" onclick="addRem()">Set Reminder</button><div id="rem-list"></div></div>
    </div>
    
    <div id="page-life" class="page">
        <div class="card"><div class="card-title">üéØ Focus</div><div style="font-size:40px;text-align:center;padding:20px">25:00</div><button class="btn btn-blue">Start</button></div>
    </div>

</div>

<div class="toast" id="toast"><span style="font-size:20px">‚úÖ</span><span id="toast-msg">Success</span></div>

<script>
const APP = {
    water: 0, journey: null, history: JSON.parse(localStorage.getItem('sun_hist')||'[]'),
    parking: JSON.parse(localStorage.getItem('sun_park')||'null'), reminders: [], map: null, watchId: null
};

document.addEventListener('DOMContentLoaded', () => {
    updateClock(); setInterval(updateClock, 1000);
    APP.water = parseInt(localStorage.getItem('sun_water') || '0');
    updateWaterUI(); updateHistoryUI(); updateParkingUI();
    getWeather('Johor Jaya'); getQuakes(); getRates(); getNews();
});

// UI Switcher
function switchPage(id, btn) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.getElementById('page-'+id).classList.add('active');
    document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    if(id === 'journey' && APP.map) setTimeout(()=>APP.map.invalidateSize(), 200);
}

function updateClock() {
    const d = new Date();
    document.getElementById('clockTime').textContent = d.toLocaleTimeString('en-US',{hour:'2-digit',minute:'2-digit',hour12:false});
    document.getElementById('clockDate').textContent = d.toLocaleDateString('en-US',{weekday:'short', month:'short', day:'numeric'});
}

function showToast(msg) {
    const t = document.getElementById('toast');
    document.getElementById('toast-msg').textContent = msg;
    t.classList.add('show');
    setTimeout(() => t.classList.remove('show'), 2000);
}

// üíß Hydration
function modWater(n) {
    APP.water = n === 0 ? 0 : Math.min(APP.water + n, 12);
    localStorage.setItem('sun_water', APP.water);
    updateWaterUI();
    showToast(n===0 ? 'Reset' : `+${n} Cup`);
}
function updateWaterUI() {
    document.getElementById('waterVal').textContent = APP.water;
    document.getElementById('waterBar').style.width = (APP.water/8*100) + '%';
}

// üí¨ Chat Logic (From V9)
const MEDICAL = {
    stomach: 'ü§¢ Avoid spicy food. Drink ginger tea.',
    fever: 'ü§í Drink plenty of water. Take Paracetamol if needed.',
    head: 'üß† Rest in a dark room. Stay hydrated.',
    tired: 'üò¥ Take a 20min power nap.'
};
function sendChat() {
    const inp = document.getElementById('chatInput');
    const txt = inp.value.trim().toLowerCase();
    if(!txt) return;
    addChat(inp.value, 'user');
    inp.value = '';
    
    setTimeout(() => {
        let reply = "I didn't understand. Try 'weather', 'rates', or medical terms.";
        if(txt.includes('weather')) reply = "Check the Weather tab for details.";
        if(txt.includes('rate')) reply = "Check Tools tab for live rates.";
        for(let k in MEDICAL) if(txt.includes(k)) reply = MEDICAL[k];
        if(txt.includes('hello')) reply = "Hi there! How can I help?";
        addChat(reply, 'bot');
    }, 500);
}
function addChat(txt, type) {
    const b = document.getElementById('chatBox');
    b.innerHTML += `<div class="chat-msg ${type}">${txt}</div>`;
    b.scrollTop = b.scrollHeight;
}

// üö® Earthquakes (Real API)
async function getQuakes() {
    try {
        const res = await fetch('https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/4.5_day.geojson');
        const d = await res.json();
        document.getElementById('dashAlerts').textContent = d.features.length;
        document.getElementById('quake-list').innerHTML = d.features.slice(0,15).map(q => `
            <div class="list-item">
                <div>
                    <div style="font-weight:600">${q.properties.place}</div>
                    <div style="font-size:12px;color:var(--text-tertiary)">${new Date(q.properties.time).toLocaleString()}</div>
                </div>
                <div class="badge-live" style="background:${q.properties.mag>6?'var(--accent-red)':'var(--accent-orange)'};color:white">M${q.properties.mag.toFixed(1)}</div>
            </div>
        `).join('');
    } catch(e) { document.getElementById('quake-list').innerHTML = 'Failed to load quakes'; }
}

// üå§Ô∏è Weather Smart Search
async function handleSearch(q) {
    if(q.length < 3) return;
    const res = await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${q}&count=5&language=en&format=json`);
    const d = await res.json();
    const list = document.getElementById('searchResults');
    if(d.results) {
        list.style.display = 'block';
        list.innerHTML = d.results.map(r => `<div class="search-item" onclick="loadCityWeather(${r.latitude},${r.longitude},'${r.name}')">${r.name}, ${r.country}</div>`).join('');
    }
}
async function loadCityWeather(lat, lon, name) {
    document.getElementById('searchResults').style.display = 'none';
    const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,weather_code`);
    const d = await res.json();
    document.getElementById('w-temp').textContent = d.current.temperature_2m + '¬∞C';
    document.getElementById('w-desc').textContent = name;
    getWeather(name); // Update home
}
async function getWeather(city) {
    // Basic home weather
    document.getElementById('dashTemp').textContent = "30¬∞";
    document.getElementById('dashWeather').innerHTML = `<div class="weather-big-icon">‚òÄÔ∏è</div><div><div class="weather-big-temp">30¬∞C</div><div class="weather-sub">${city}</div></div>`;
}

// üöó Journey (Timeline + Map)
function startJourney() {
    if(!navigator.geolocation) return showToast('No GPS');
    APP.journey = { start: Date.now(), dist: 0, lastPos: null, path: [] };
    document.getElementById('journey-start').style.display = 'none';
    document.getElementById('journey-active').style.display = 'block';
    
    if(!APP.map) {
        APP.map = L.map('map-small', {zoomControl:false}).setView([0,0], 15);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png').addTo(APP.map);
    }
    
    APP.watchId = navigator.geolocation.watchPosition(pos => {
        const {latitude, longitude, speed} = pos.coords;
        if(APP.journey.lastPos) APP.journey.dist += calcDist(APP.journey.lastPos.lat, APP.journey.lastPos.lon, latitude, longitude);
        APP.journey.lastPos = {lat: latitude, lon: longitude};
        APP.journey.path.push([latitude, longitude]);
        
        document.getElementById('jDist').textContent = APP.journey.dist.toFixed(2);
        document.getElementById('jSpeed').textContent = (speed*3.6||0).toFixed(1);
        document.getElementById('jTime').textContent = Math.floor((Date.now()-APP.journey.start)/60000);
        
        APP.map.setView([latitude, longitude]);
        L.circle([latitude, longitude], {color:'#0A84FF', radius:10}).addTo(APP.map);
    }, null, {enableHighAccuracy:true});
}
function stopJourney() {
    navigator.geolocation.clearWatch(APP.watchId);
    const j = APP.journey;
    APP.history.unshift({date: new Date().toLocaleString(), dist: j.dist.toFixed(2), time: Math.floor((Date.now()-j.start)/60000)});
    localStorage.setItem('sun_hist', JSON.stringify(APP.history));
    APP.journey = null;
    document.getElementById('journey-active').style.display = 'none';
    document.getElementById('journey-start').style.display = 'block';
    updateHistoryUI();
}
function updateHistoryUI() {
    const list = document.getElementById('journey-list');
    list.innerHTML = APP.history.slice(0,5).map(h => `<div class="list-item"><div><div style="font-weight:600">${h.dist} km</div><div style="font-size:12px;color:#888">${h.time} min</div></div><div style="font-size:12px;color:#666">${h.date}</div></div>`).join('');
    document.getElementById('dashJourneys').textContent = APP.history.length;
}

// üÖøÔ∏è Parking
function savePark(type) {
    if(type==='both'){APP.pendingGPS=true; document.getElementById('cam').click(); return;}
    navigator.geolocation.getCurrentPosition(pos => {
        APP.parking = {lat: pos.coords.latitude, lon: pos.coords.longitude, time: Date.now()};
        localStorage.setItem('sun_park', JSON.stringify(APP.parking));
        updateParkingUI();
        showToast('Saved');
    });
}
function handlePhoto(e) {
    const f = e.target.files[0];
    const reader = new FileReader();
    reader.onload = ev => {
        if(APP.pendingGPS) {
            navigator.geolocation.getCurrentPosition(pos => {
                APP.parking = {lat: pos.coords.latitude, lon: pos.coords.longitude, time: Date.now(), photo: ev.target.result};
                localStorage.setItem('sun_park', JSON.stringify(APP.parking));
                updateParkingUI();
            });
        }
    };
    reader.readAsDataURL(f);
}
function updateParkingUI() {
    const p = APP.parking;
    const d = document.getElementById('park-display');
    if(!p) { d.innerHTML = 'No location'; return; }
    d.innerHTML = `Saved: ${new Date(p.time).toLocaleTimeString()}` + (p.photo ? `<img src="${p.photo}" style="width:100%;border-radius:10px;margin-top:10px">` : '') + (p.lat ? `<br><a href="https://maps.google.com/?q=${p.lat},${p.lon}" target="_blank" class="btn btn-blue" style="margin-top:10px;display:block;text-decoration:none">Map</a>` : '');
}

// üõ†Ô∏è Tools
async function getRates() {
    try {
        const r = await fetch('https://api.exchangerate-api.com/v4/latest/MYR');
        const d = await r.json();
        document.getElementById('rate-list').innerHTML = `USD: ${(1/d.rates.USD).toFixed(2)} | SGD: ${(1/d.rates.SGD).toFixed(2)}`;
    } catch(e){}
}
function addRem() {
    const t = document.getElementById('rem-txt').value;
    if(t) { APP.reminders.push(t); showToast('Reminder Set'); }
}
async function getNews() {
    // RSS simulation
    document.getElementById('news-feed').innerHTML = `<div class="list-item">Global Tech Rally 2025</div><div class="list-item">Local Weather Alert</div>`;
}

function calcDist(lat1,lon1,lat2,lon2) { const R=6371; const dLat=(lat2-lat1)*Math.PI/180; const dLon=(lon2-lon1)*Math.PI/180; const a=Math.sin(dLat/2)**2+Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLon/2)**2; return R*2*Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); }
</script>
</body>
</html>
